data = {
    "historical": [
    {
      "date": "2015-01-01",
      "trend": 953.2,
      "value": 911.6
    },
    {
      "date": "2015-02-01",
      "trend": 957.5,
      "value": 966.9
    },
    {
      "date": "2015-03-01",
      "trend": 961.4,
      "value": 1046
    },
    {
      "date": "2015-04-01",
      "trend": 965.7,
      "value": 1059
    },
    {
      "date": "2015-05-01",
      "trend": 969.8,
      "value": 946.8
    },
    {
      "date": "2015-06-01",
      "trend": 974.1,
      "value": 929.2
    },
    {
      "date": "2015-07-01",
      "trend": 978.2,
      "value": 938.3
    },
    {
      "date": "2015-08-01",
      "trend": 982.5,
      "value": 956.7
    },
    {
      "date": "2015-09-01",
      "trend": 986.8,
      "value": 951.8
    },
    {
      "date": "2015-10-01",
      "trend": 991,
      "value": 933.6
    },
    {
      "date": "2015-11-01",
      "trend": 995.2,
      "value": 932.3
    },
    {
      "date": "2015-12-01",
      "trend": 999.4,
      "value": 932.3
    },
    {
      "date": "2016-01-01",
      "trend": 1004,
      "value": 1011
    },
    {
      "date": "2016-02-01",
      "trend": 1008,
      "value": 1052
    },
    {
      "date": "2016-03-01",
      "trend": 1012,
      "value": 1021
    },
    {
      "date": "2016-04-01",
      "trend": 1016,
      "value": 998.1
    },
    {
      "date": "2016-05-01",
      "trend": 1020,
      "value": 987.6
    },
    {
      "date": "2016-06-01",
      "trend": 1025,
      "value": 993.2
    },
    {
      "date": "2016-07-01",
      "trend": 1029,
      "value": 1005
    },
    {
      "date": "2016-08-01",
      "trend": 1033,
      "value": 1052
    },
    {
      "date": "2016-09-01",
      "trend": 1037,
      "value": 1013
    },
    {
      "date": "2016-10-01",
      "trend": 1042,
      "value": 976.4
    },
    {
      "date": "2016-11-01",
      "trend": 1046,
      "value": 959.9
    },
    {
      "date": "2016-12-01",
      "trend": 1050,
      "value": 959.9
    },
    {
      "date": "2017-01-01",
      "trend": 1054,
      "value": 974
    },
    {
      "date": "2017-02-01",
      "trend": 1059,
      "value": 1040
    },
    {
      "date": "2017-03-01",
      "trend": 1062,
      "value": 1075
    },
    {
      "date": "2017-04-01",
      "trend": 1067,
      "value": 1064
    },
    {
      "date": "2017-05-01",
      "trend": 1071,
      "value": 1083
    },
    {
      "date": "2017-06-01",
      "trend": 1075,
      "value": 1098
    },
    {
      "date": "2017-07-01",
      "trend": 1079,
      "value": 1098
    },
    {
      "date": "2017-08-01",
      "trend": 1084,
      "value": 1098
    },
    {
      "date": "2017-09-01",
      "trend": 1088,
      "value": 1098
    },
    {
      "date": "2017-10-01",
      "trend": 1092,
      "value": 1087
    },
    {
      "date": "2017-11-01",
      "trend": 1096,
      "value": 1084
    },
    {
      "date": "2017-12-01",
      "trend": 1100,
      "value": 1091
    },
    {
      "date": "2018-01-01",
      "trend": 1105,
      "value": 1117
    },
    {
      "date": "2018-02-01",
      "trend": 1109,
      "value": 1267
    },
    {
      "date": "2018-03-01",
      "trend": 1113,
      "value": 1173
    },
    {
      "date": "2018-04-01",
      "trend": 1117,
      "value": 1159
    },
    {
      "date": "2018-05-01",
      "trend": 1121,
      "value": 1147
    },
    {
      "date": "2018-06-01",
      "trend": 1126,
      "value": 1161
    },
    {
      "date": "2018-07-01",
      "trend": 1130,
      "value": 1138
    },
    {
      "date": "2018-08-01",
      "trend": 1134,
      "value": 1111
    },
    {
      "date": "2018-09-01",
      "trend": 1138,
      "value": 1115
    },
    {
      "date": "2018-10-01",
      "trend": 1142,
      "value": 1126
    },
    {
      "date": "2018-11-01",
      "trend": 1147,
      "value": 1126
    },
    {
      "date": "2018-12-01",
      "trend": 1151,
      "value": 1133
    },
    {
      "date": "2019-01-01",
      "trend": 1155,
      "value": 1140
    },
    {
      "date": "2019-02-01",
      "trend": 1159,
      "value": 1149
    },
    {
      "date": "2019-03-01",
      "trend": 1163,
      "value": 1180
    },
    {
      "date": "2019-04-01",
      "trend": 1168,
      "value": 1176
    },
    {
      "date": "2019-05-01",
      "trend": 1172,
      "value": 1126
    },
    {
      "date": "2019-06-01",
      "trend": 1176,
      "value": 1126
    },
    {
      "date": "2019-07-01",
      "trend": 1180,
      "value": 1126
    },
    {
      "date": "2019-08-01",
      "trend": 1184,
      "value": 1126
    },
    {
      "date": "2019-09-01",
      "trend": 1189,
      "value": 1153
    },
    {
      "date": "2019-10-01",
      "trend": 1193,
      "value": 1137
    },
    {
      "date": "2019-11-01",
      "trend": 1197,
      "value": 1126
    },
    {
      "date": "2019-12-01",
      "trend": 1201,
      "value": 1147
    },
    {
      "date": "2020-01-01",
      "trend": 1206,
      "value": 1177
    },
    {
      "date": "2020-02-01",
      "trend": 1210,
      "value": 1188
    },
    {
      "date": "2020-03-01",
      "trend": 1214,
      "value": 1192
    },
    {
      "date": "2020-04-01",
      "trend": 1218,
      "value": 1277
    },
    {
      "date": "2020-05-01",
      "trend": 1222,
      "value": 1298
    },
    {
      "date": "2020-06-01",
      "trend": 1227,
      "value": 1298
    },
    {
      "date": "2020-07-01",
      "trend": 1231,
      "value": 1286
    },
    {
      "date": "2020-08-01",
      "trend": 1235,
      "value": 1247
    },
    {
      "date": "2020-09-01",
      "trend": 1239,
      "value": 1224
    },
    {
      "date": "2020-10-01",
      "trend": 1243,
      "value": 1136
    },
    {
      "date": "2020-11-01",
      "trend": 1248,
      "value": 1133
    },
    {
      "date": "2020-12-01",
      "trend": 1252,
      "value": 1151
    },
    {
      "date": "2021-01-01",
      "trend": 1256,
      "value": 1239
    },
    {
      "date": "2021-02-01",
      "trend": 1260,
      "value": 1226
    },
    {
      "date": "2021-03-01",
      "trend": 1264,
      "value": 1229
    },
    {
      "date": "2021-04-01",
      "trend": 1269,
      "value": 1229
    },
    {
      "date": "2021-05-01",
      "trend": 1273,
      "value": 1229
    },
    {
      "date": "2021-06-01",
      "trend": 1277,
      "value": 1229
    },
    {
      "date": "2021-07-01",
      "trend": 1281,
      "value": 1239
    },
    {
      "date": "2021-08-01",
      "trend": 1285,
      "value": 1229
    },
    {
      "date": "2021-09-01",
      "trend": 1290,
      "value": 1188
    },
    {
      "date": "2021-10-01",
      "trend": 1294,
      "value": 1155
    },
    {
      "date": "2021-11-01",
      "trend": 1298,
      "value": 1148
    },
    {
      "date": "2021-12-01",
      "trend": 1302,
      "value": 1160
    },
    {
      "date": "2022-01-01",
      "trend": 1307,
      "value": 1162
    },
    {
      "date": "2022-02-01",
      "trend": 1311,
      "value": 1254
    },
    {
      "date": "2022-03-01",
      "trend": 1315,
      "value": 1391
    },
    {
      "date": "2022-04-01",
      "trend": 1319,
      "value": 1460
    },
    {
      "date": "2022-05-01",
      "trend": 1323,
      "value": 1464
    },
    {
      "date": "2022-06-01",
      "trend": 1327,
      "value": 1440
    },
    {
      "date": "2022-07-01",
      "trend": 1332,
      "value": 1515
    },
    {
      "date": "2022-08-01",
      "trend": 1336,
      "value": 1672
    },
    {
      "date": "2022-09-01",
      "trend": 1340,
      "value": 1626
    },
    {
      "date": "2022-10-01",
      "trend": 1344,
      "value": 1576
    },
    {
      "date": "2022-11-01",
      "trend": 1349,
      "value": 1664
    },
    {
      "date": "2022-12-01",
      "trend": 1353,
      "value": 1685
    },
    {
      "date": "2023-01-01",
      "trend": 1357,
      "value": 1685
    },
    {
      "date": "2023-02-01",
      "trend": 1361,
      "value": 1675
    },
    {
      "date": "2023-03-01",
      "trend": 1365,
      "value": 1616
    },
    {
      "date": "2023-04-01",
      "trend": 1369,
      "value": 1657
    },
    {
      "date": "2023-05-01",
      "trend": 1374,
      "value": 1614
    },
    {
      "date": "2023-06-01",
      "trend": 1378,
      "value": 1596
    },
    {
      "date": "2023-07-01",
      "trend": 1382,
      "value": 1554
    },
    {
      "date": "2023-08-01",
      "trend": 1386,
      "value": 1561
    },
    {
      "date": "2023-09-01",
      "trend": 1391,
      "value": 1567
    },
    {
      "date": "2023-10-01",
      "trend": 1395,
      "value": 1575
    },
    {
      "date": "2023-11-01",
      "trend": 1399,
      "value": 1551
    },
    {
      "date": "2023-12-01",
      "trend": 1403,
      "value": 1547
    },
    {
      "date": "2024-01-01",
      "trend": 1407,
      "value": 1608
    },
    {
      "date": "2024-02-01",
      "trend": 1412,
      "value": 1579
    },
    {
      "date": "2024-03-01",
      "trend": 1416,
      "value": 1652
    },
    {
      "date": "2024-04-01",
      "trend": 1420,
      "value": 1627
    },
    {
      "date": "2024-05-01",
      "trend": 1424,
      "value": 1410
    },
    {
      "date": "2024-06-01",
      "trend": 1428,
      "value": 1091
    },
    {
      "date": "2024-07-01",
      "trend": 1433,
      "value": 1043
    },
    {
      "date": "2024-08-01",
      "trend": 1437,
      "value": 1020
    },
    {
      "date": "2024-09-01",
      "trend": 1441,
      "value": 1035
    },
    {
      "date": "2024-10-01",
      "trend": 1445,
      "value": 1044
    },
    {
      "date": "2024-11-01",
      "trend": 1450,
      "value": 880
    },
    {
      "date": "2024-12-01",
      "trend": 1454,
      "value": 841.3
    },
    {
      "date": "2025-01-01",
      "trend": 1458,
      "value": 1123
    },
    {
      "date": "2025-02-01",
      "trend": 1462,
      "value": 1250
    }
  ]
}

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.statespace.sarimax import SARIMAX

# Create a DataFrame from your historical data
df = pd.DataFrame(data["historical"])

# Convert the 'date' column to datetime objects and set it as the DataFrame index
df["date"] = pd.to_datetime(df["date"])
df.set_index("date", inplace=True)

# Predict the next 3 months
forecast_steps = 24
# Create future dates with a monthly start frequency ('MS')
future_dates = pd.date_range(start=df.index[-1] + pd.DateOffset(months=1),
                             periods=forecast_steps,
                             freq='MS')

# recent volatility
# Calculate the differences between consecutive months
monthly_changes = df["value"].diff().dropna()
# Compute the exponential weighted standard deviation (recent volatility)
recent_volatility = monthly_changes.ewm(span=12, adjust=False).std().iloc[-1]
print("Recent Volatility:", recent_volatility)
multiplier = 1

# sarima model forecast
seasonal_period = 24
model = SARIMAX(df["value"],
                order=(1, 1, 1),
                seasonal_order=(1, 1, 1, seasonal_period),
                enforce_stationarity=False,
                enforce_invertibility=False)
model_fit = model.fit(disp=False)
sarima_forecast = model_fit.forecast(steps=forecast_steps)

# forecast weights
optimistic_forecast = sarima_forecast + multiplier * recent_volatility
pessimistic_forecast = sarima_forecast - multiplier * recent_volatility

# plotting
plt.figure(figsize=(12, 6))
plt.plot(df.index, df["value"], label='Historical Data')
plt.axvline(df.index[-1], color='gray', linestyle='--', label='Forecast Start')
plt.plot(future_dates, sarima_forecast, label='SARIMA Forecast', color='green')
plt.plot(future_dates, optimistic_forecast, label='Optimistic Forecast', color='green', linestyle='--')
plt.plot(future_dates, pessimistic_forecast, label='Pessimistic Forecast', color='red', linestyle='--')

# Shade area between SARIMA and optimistic forecast (green)
plt.fill_between(future_dates, sarima_forecast, optimistic_forecast, 
                 where=(optimistic_forecast >= sarima_forecast), color='green', alpha=0.3, interpolate=True)

# Shade area between SARIMA and pessimistic forecast (red)
plt.fill_between(future_dates, sarima_forecast, pessimistic_forecast, 
                 where=(pessimistic_forecast <= sarima_forecast), color='red', alpha=0.3, interpolate=True)

plt.xlabel('Date')
plt.ylabel('Value')
plt.title('SARIMA Forecast with Recent Volatility-Based Bounds (Next 3 Months)')
plt.legend()
plt.savefig("fig.png")


from fpdf import FPDF
pdf = FPDF()
pdf.add_page()

# Add a header text
pdf.set_font("Arial", "B", 16)
pdf.cell(0, 10, "Forecast Report", ln=True, align="C")

# Add some temporary descriptive text
pdf.set_font("Arial", size=12)
pdf.multi_cell(0, 10, "A totally CRAZY BANANAS prediction powered by BananAI!!!")

# Insert the saved plot image into the PDF
# Adjust x, y, and width as necessary
pdf.image("fig.png", x=10, y=40, w=190)

# Save the PDF to a file
pdf.output("forecast_report.pdf")
print("PDF report generated successfully!")
